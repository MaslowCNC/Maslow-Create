<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/js/prototypes/atom.js | canvas-template</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#js">js</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/BOM.js~BOMEntry.html">BOMEntry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/globalvariables.js~GlobalVariables.html">GlobalVariables</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-convertLinks">convertLinks</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extractBomTags">extractBomTags</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-showGitHubSearch">showGitHubSearch</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addOrDeletePorts">addOrDeletePorts</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GitHubModule">GitHubModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-cmenu">cmenu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-globalVariables">globalVariables</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-licenses">licenses</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#js-molecules">js/molecules</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/BOM.js~AddBOMTag.html">AddBOMTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/assembly.js~Assembly.html">Assembly</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/box.js~Box.html">Box</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/circle.js~Circle.html">Circle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/code.js~Code.html">Code</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/color.js~Color.html">Color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/constant.js~Constant.html">Constant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/cutlayout.js~CutLayout.html">CutLayout</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/cutlist.js~CutList.html">CutList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/difference.js~Difference.html">Difference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/equation.js~Equation.html">Equation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/extracttag.js~ExtractTag.html">ExtractTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/extrude.js~Extrude.html">Extrude</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/gcode.js~Gcode.html">Gcode</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/geneticAlgorithm.js~GeneticAlgorithm.html">GeneticAlgorithm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/githubmolecule.js~GitHubMolecule.html">GitHubMolecule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/group.js~Group.html">Group</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/input.js~Input.html">Input</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/intersection.js~Intersection.html">Intersection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/molecule.js~Molecule.html">Molecule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/move.js~Move.html">Move</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/nest.js~Nest.html">Nest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/output.js~Output.html">Output</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/readme.js~Readme.html">Readme</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/rectangle.js~Rectangle.html">Rectangle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/regularPolygon.js~RegularPolygon.html">RegularPolygon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/rotate.js~Rotate.html">Rotate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/shrinkwrap.js~ShrinkWrap.html">ShrinkWrap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/stl.js~Stl.html">Stl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/svg.js~Svg.html">Svg</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/tag.js~Tag.html">Tag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/uploadSVG.js~UploadSVG.html">UploadSVG</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#js-prototypes">js/prototypes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/prototypes/atom.js~Atom.html">Atom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/prototypes/attachmentpoint.js~AttachmentPoint.html">AttachmentPoint</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/prototypes/connector.js~Connector.html">Connector</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/js/prototypes/atom.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import AttachmentPoint from &apos;./attachmentpoint&apos;
import GlobalVariables from &apos;../globalvariables&apos;
import showdown  from &apos;showdown&apos;

/**
 * This class is the prototype for all atoms.
 */
export default class Atom {

    /**
     * The constructor function.
     * @param {object} values An array of values passed in which will be assigned to the class as this.x
     */ 
    constructor(values){
        //Setup default values
        /** 
         * An array of all of the input attachment points connected to this atom
         * @type {array}
         */
        this.inputs = []
        /** 
         * This atom&apos;s output attachment point if it has one
         * @type {object}
         */
        this.output = null
        /** 
         * This atom&apos;s unique ID. Often overwritten later when loading
         * @type {number}
         */
        this.uniqueID = GlobalVariables.generateUniqueID()
        /** 
         * A description of this atom
         * @type {string}
         */
        this.description = &quot;none&quot;
        /** 
         * The X cordinate of this atom
         * @type {number}
         */
        this.x = 0
        /** 
         * The Y cordinate of this atom
         * @type {number}
         */
        this.y = 0
        /** 
         * This atom&apos;s radius as displayed on the screen is 1/72 width
         * @type {number}
         */
        this.radius = 1/75
        /** 
         * This atom&apos;s default color (ie when not selected or processing)
         * @type {string}
         */
        this.defaultColor = &apos;#F3EFEF&apos;
        /** 
         * This atom&apos;s color when selected
         * @type {string}
         */
        this.selectedColor = &apos;#484848&apos;
        /** 
         * The color currently used for strokes
         * @type {string}
         */
        this.strokeColor = &apos;#484848&apos;
        /** 
         * A flag to indicate if this atom is currently selected
         * @type {boolean}
         */
        this.selected = false
        /** 
         * This atom&apos;s current color
         * @type {string}
         */
        this.color = &apos;#F3EFEF&apos;
        /** 
         * This atom&apos;s name
         * @type {string}
         */
        this.name = &apos;name&apos;
        /** 
         * This atom&apos;s parent, usually the molecule which contains this atom
         * @type {object}
         */
        this.parentMolecule = null
        /** 
         * This atom&apos;s value...Is can this be done away with? Are we basically storing the value in the output now?
         * @type {object}
         */
        this.value = null
        /** 
         * A flag to indicate if this atom is currently being dragged on the screen.
         * @type {boolean}
         */
        this.isMoving = false
        /** 
         * A flag to indicate if we are hovering over this atom.
         * @type {boolean}
         */
        this.showHover = false
        /** 
         * The X coordinate of this atom now
         * @type {number}
         */
        this.x = 0
        /** 
         * The Y coordinate of this atom now
         * @type {number}
         */
        this.y = 0
        /** 
         * A warning message displayed next to the atom. Put text in here to have a warning automatically show up. Cleared each time the output is regenerated.
         * @type {string}
         */
        this.alertMessage = &apos;&apos;
        /** 
         * A flag to indicate if the atom is currently computing a new output. Turns the molecule blue.
         * @type {boolean}
         */
        this.processing = false
        /** 
         * The path which contains the geometry represented by this atom
         * @type {string}
         */
        this.path = &quot;&quot;
        /** 
         * A function which can be called to cancel the processing being done for this atom.
         * @type {function}
         */
        this.cancelProcessing = () =&gt; {console.warn(&quot;Nothing to cancel&quot;)}

        for(var key in values) {
            /** 
             * Assign each of the values in values as this.value
             */
            this[key] = values[key]
        }
        
        this.generatePath()
    }
    
    /**
     * Generates the path for this atom from it&apos;s location in the graph
     */ 
    generatePath(){
        let levelToInspect = this
        let topPath = &quot;&quot;
        while(!levelToInspect.topLevel){
            topPath = &quot;/&quot; + levelToInspect.uniqueID + topPath
            levelToInspect = levelToInspect.parent
        }
        
        this.path =&quot;source/&quot; + levelToInspect.uniqueID + topPath + this.atomType

    }
    
    /**
     * Applies each of the passed values to this as this.x
     * @param {object} values - A list of values to set
     */ 
    setValues(values){
        //Assign the object to have the passed in values
        
        for(var key in values) {
            this[key] = values[key]
        }
        
        this.generatePath()
        
        if (typeof this.ioValues !== &apos;undefined&apos;) {
            this.ioValues.forEach(ioValue =&gt; { //for each saved value
                this.inputs.forEach(io =&gt; {  //Find the matching IO and set it to be the saved value
                    if(ioValue.name == io.name &amp;&amp; io.type == &apos;input&apos;){
                        io.value = ioValue.ioValue
                    }
                })
            })
        }
    }
   
    /**
     * Draws the atom on the screen
     */ 
    draw(drawType) {

        let xInPixels = GlobalVariables.widthToPixels(this.x)
        let yInPixels = GlobalVariables.heightToPixels(this.y)
        let radiusInPixels = GlobalVariables.widthToPixels(this.radius)

        this.inputs.forEach(child =&gt; {
            child.draw()       
        })

        GlobalVariables.c.beginPath()
        GlobalVariables.c.font = &apos;10px Work Sans&apos;

        if(this.processing){
            GlobalVariables.c.fillStyle = &apos;blue&apos;
        }
        else if(this.selected){
            GlobalVariables.c.fillStyle = this.selectedColor
            GlobalVariables.c.strokeStyle = this.selectedColor
            this.color = this.selectedColor
            this.strokeColor = this.defaultColor
        }
        else{
            GlobalVariables.c.fillStyle = this.defaultColor
            GlobalVariables.c.strokeStyle = this.selectedColor
            this.color = this.defaultColor
            this.strokeColor = this.selectedColor
        }

        GlobalVariables.c.beginPath()
        if (drawType == &quot;rect&quot;){
            GlobalVariables.c.rect(xInPixels - radiusInPixels, yInPixels - this.height/2, 2* radiusInPixels, this.height)
        }
        else{
            GlobalVariables.c.arc(xInPixels, yInPixels, radiusInPixels, 0, Math.PI * 2, false)
        }
        GlobalVariables.c.textAlign = &apos;start&apos; 
        GlobalVariables.c.fill()
        GlobalVariables.c.strokeStyle = this.strokeColor
        GlobalVariables.c.fillStyle = &quot;white&quot;
        GlobalVariables.c.stroke()
        GlobalVariables.c.closePath()

        GlobalVariables.c.beginPath()
        GlobalVariables.c.textAlign = &apos;start&apos;
        GlobalVariables.c.fillText(this.name, xInPixels + radiusInPixels, yInPixels - radiusInPixels)
        GlobalVariables.c.fill()
        GlobalVariables.c.strokeStyle = this.strokeColor
        GlobalVariables.c.lineWidth = 1
        GlobalVariables.c.stroke()
        GlobalVariables.c.closePath()

        if (this.showHover){
           
            if (this.alertMessage.length &gt; 0){
                this.color = &quot;red&quot;

                //Draw Alert block  
                GlobalVariables.c.beginPath()
                const padding = 10
                GlobalVariables.c.fillStyle = &apos;red&apos;
                GlobalVariables.c.rect(
                    xInPixels + radiusInPixels - padding/2, 
                    yInPixels - radiusInPixels + padding/2, 
                    GlobalVariables.c.measureText(this.alertMessage.toUpperCase()).width + padding, 
                    - (parseInt(GlobalVariables.c.font) + padding))
                GlobalVariables.c.fill()
                GlobalVariables.c.strokeStyle = &apos;black&apos;
                GlobalVariables.c.lineWidth = 1
                GlobalVariables.c.stroke()
                GlobalVariables.c.closePath()

                GlobalVariables.c.beginPath()
                GlobalVariables.c.fillStyle = &apos;black&apos;
                GlobalVariables.c.fillText(this.alertMessage.toUpperCase(), xInPixels + radiusInPixels, yInPixels - radiusInPixels) 
                GlobalVariables.c.closePath()
                
            } 
        }
    }
    
    /**
     * Adds a new attachment point to this atom
     * @param {boolean} type - The type of the IO (input or output)
     * @param {string} name - The name of the new attachment point
     * @param {object} target - The atom to attach the new attachment point to. Should we force this to always be this one?
     * @param {string} valueType - Describes the type of value the input is expecting options are number, geometry, array
     * @param {object} defaultValue - The default value to be used when the value is not yet set
     */ 
    addIO(type, name, target, valueType, defaultValue, ready, primary = false){
        
        if(target.inputs.find(o =&gt; (o.name === name &amp;&amp; o.type === type))== undefined){ //Check to make sure there isn&apos;t already an IO with the same type and name
            //compute the baseline offset from parent node
            var offset
            if (type == &apos;input&apos;){
                offset = -1* target.scaledRadius
            }
            else{
                offset = target.scaledRadius
            }
            var newAp = new AttachmentPoint({
                parentMolecule: target,
                defaultOffsetX: offset,
                defaultOffsetY: 0,
                type: type,
                valueType: valueType,
                name: name,
                primary: primary,
                value: defaultValue,
                defaultValue: defaultValue,
                uniqueID: GlobalVariables.generateUniqueID(),
                atomType: &apos;AttachmentPoint&apos;,
                ready: true
            })
            
            if(type == &apos;input&apos;){
                target.inputs.push(newAp)
            }else{
                target.output = newAp
            }
        }
    }
    
    /**
     * Removes an attachment point from an atom.
     * @param {boolean} type - The type of the IO (input or output).
     * @param {string} name - The name of the new attachment point.
     * @param {object} target - The attom which the attachment point is attached to. Should 
     * @param {object} silent - Should any connected atoms be informed of the change
     */ 
    removeIO(type, name, target, silent = false){
        //Remove the target IO attachment point
        target.inputs.forEach(input =&gt; {
            if(input.name == name &amp;&amp; input.type == type){
                target.inputs.splice(target.inputs.indexOf(input),1)
                input.deleteSelf(silent)
            }
        })
    }
    
    /**
     * Set an alert to display next to the atom.
     * @param {string} message - The message to display.
     */ 
    setAlert(message){
        this.color = &apos;orange&apos;
        this.alertMessage = String(message)
        console.warn(message)
    }
    
    /**
     * Clears the alert message attached to this atom.
     */ 
    clearAlert(){
        this.color = this.defaultColor
        this.alertMessage = &apos;&apos;
    }

    /**
     * Delineates bounds for selection box.
     */ 
    selectBox(x,y,xEnd,yEnd){
        let xIn = Math.min(x, xEnd)
        let xOut = Math.max(x, xEnd)
        let yIn = Math.min(y, yEnd)
        let yOut = Math.max(y, yEnd)
        let xInPixels = GlobalVariables.widthToPixels(this.x)
        let yInPixels = GlobalVariables.heightToPixels(this.y)
        if(xInPixels &gt;= xIn &amp;&amp; xInPixels &lt;= xOut){
            if(yInPixels &gt;= yIn &amp;&amp; yInPixels &lt;= yOut){
                //this.isMoving = true
                this.selected = true
            }
        }
    }

    /**
     * Set the atom&apos;s response to a mouse click. This usually means selecting the atom and displaying it&apos;s contents in 3D
     * @param {number} x - The X coordinate of the click
     * @param {number} y - The Y coordinate of the click
     * @param {boolean} clickProcessed - A flag to indicate if the click has already been processed
     */ 
    clickDown(x,y, clickProcessed){
        let xInPixels = GlobalVariables.widthToPixels(this.x)
        let yInPixels = GlobalVariables.heightToPixels(this.y)
        let radiusInPixels = GlobalVariables.widthToPixels(this.radius)

        //If none of the inputs processed the click see if the atom should, if not clicked, then deselected
        if(!clickProcessed &amp;&amp; GlobalVariables.distBetweenPoints(x, xInPixels, y, yInPixels) &lt; radiusInPixels){
            this.isMoving = true
            this.selected = true
            this.updateSidebar()
            this.sendToRender()
            clickProcessed = true
        }
        //Deselect this if it wasn&apos;t clicked on, unless control is held
        else if (!GlobalVariables.ctrlDown){
            this.selected = false
        }         
        //Returns true if something was done with the click
        this.inputs.forEach(child =&gt; {
            if(child.clickDown(x,y, clickProcessed) == true){
                clickProcessed = true
            }
        })
        if(this.output){
            if(this.output.clickDown(x,y, clickProcessed) == true){
                clickProcessed = true
            }
        }
           
        return clickProcessed 
    }

    /**
     * Set the atom&apos;s response to a mouse double click. By default this isn&apos;t to do anything other than mark the double click as handled.
     * @param {number} x - The X cordinate of the click
     * @param {number} y - The Y cordinate of the click
     */ 
    doubleClick(x,y){
        //returns true if something was done with the click
        let xInPixels = GlobalVariables.widthToPixels(this.x)
        let yInPixels = GlobalVariables.heightToPixels(this.y)
        var clickProcessed = false
        
        var distFromClick = GlobalVariables.distBetweenPoints(x, xInPixels, y, yInPixels)
        
        if (distFromClick &lt; xInPixels){
            clickProcessed = true
        }
        
        return clickProcessed 
    }

    /**
     * Set the atom&apos;s response to a mouse click up. If the atom is moving this makes it stop moving.
     * @param {number} x - The X cordinate of the click
     * @param {number} y - The Y cordinate of the click
     */ 
    clickUp(x,y){
        this.isMoving = false
        
        this.inputs.forEach(child =&gt; {
            child.clickUp(x,y)     
        })
        if(this.output){
            this.output.clickUp(x,y)
        }
    }
    
    /**
     * Set the atom&apos;s response to a mouse click and drag. Moves the atom around the screen.
     * @param {number} x - The X cordinate of the click
     * @param {number} y - The Y cordinate of the click
     */ 
    clickMove(x,y){

        let xInPixels = GlobalVariables.widthToPixels(this.x)
        let yInPixels = GlobalVariables.heightToPixels(this.y)
        let radiusInPixels = GlobalVariables.widthToPixels(this.radius)
        if (this.isMoving == true){
            this.x = GlobalVariables.pixelsToWidth(x)
            this.y = GlobalVariables.pixelsToHeight(y)
        }
        
        this.inputs.forEach(child =&gt; {
            child.clickMove(x,y)       
        })
        if(this.output){
            this.output.clickMove(x,y)
        }
        
        var distFromClick = GlobalVariables.distBetweenPoints(x, xInPixels, y, yInPixels)
        
        //If we are close to the attachment point move it to it&apos;s hover location to make it accessible
        if (distFromClick &lt; radiusInPixels ){
            this.showHover = true
        }  
        else { this.showHover = false}
    }
    
    /**
     * Set the atom&apos;s response to a key press. Is used to delete the atom if it is selected.
     * @param {string} key - The key which has been pressed.
     */ 
    keyPress(key){ 

      
        this.inputs.forEach(child =&gt; {
            child.keyPress(key)
        })
    }
    
    /**
     * Updates the side bar to display information about the atom. By default this is just add a title and to let you edit any unconnected inputs.
     */ 
    updateSidebar(){
        //updates the sidebar to display information about this node
        
        var valueList = this.initializeSideBar()
        
        //Add options to set all of the inputs
        this.inputs.forEach(input =&gt; {
            if(input.type == &apos;input&apos; &amp;&amp; input.valueType != &apos;geometry&apos; &amp;&amp; input.connectors.length == 0){
                if(input.valueType == &apos;number&apos;){
                    this.createEditableValueListItem(valueList,input,&apos;value&apos;, input.name, true)
                }
                else{
                    this.createEditableValueListItem(valueList,input,&apos;value&apos;, input.name, false)
                }
            }
        })
        
        //Add a delete button if we are using the touch interface
        if(GlobalVariables.touchInterface){
            this.createButton(valueList,this,&quot;Delete&quot;,()=&gt;{this.deleteNode()})
        }
        
        return valueList
    }
    
    /**
     * Initialized the sidebar with a title and create the HTML object.
     */ 
    initializeSideBar(){

        //remove everything in the sideBar now
        let sideBar = document.querySelector(&apos;.sideBar&apos;)
        //Updates sidebar values before erasing
        var editables = document.querySelectorAll(&quot;.editing-item&quot;)
        editables.forEach(function(value) {
            value.blur()
        })

        while (sideBar.firstChild) { 
            sideBar.removeChild(sideBar.firstChild)
        }

        //adds the name of the molecule to sideBar
        var name2 = document.createElement(&apos;p&apos;)
        name2.textContent = this.name
        sideBar.appendChild(name2)
        name2.setAttribute(&apos;class&apos;,&apos;molecule_title&apos;)
        
        //adds the name of the molecule to sideBar
        var description = document.createElement(&apos;p&apos;)
        description.textContent = this.description
        sideBar.appendChild(description)
        description.setAttribute(&apos;class&apos;,&apos;atom_description&apos;)
        

        //add the name as of project title 
        if (this.atomType == &apos;Molecule&apos; ){
            let headerBar_title = document.querySelector(&apos;#headerBar_title&apos;)
            if(headerBar_title){
                while (headerBar_title.firstChild) {
                    headerBar_title.removeChild(headerBar_title.firstChild)
                }
               
                var name1 = document.createElement(&apos;p&apos;)
                name1.textContent = &quot;- &quot; + GlobalVariables.topLevelMolecule.name
                headerBar_title.appendChild(name1)
            }
        }

        //Create a list element
        var valueList = document.createElement(&apos;ul&apos;)
        sideBar.appendChild(valueList)
        valueList.setAttribute(&apos;class&apos;, &apos;sidebar-list&apos;)

        
        return valueList

    }

    /**
     * Delete this atom. Silent prevents it from telling its neighbors
     */ 
    deleteNode(backgroundClickAfter = true, deletePath = true, silent = false){
        //deletes this node and all of it&apos;s inputs
        
        this.inputs.forEach(input =&gt; { //disable the inputs before deleting
            input.ready = false
        })
        
        const inputsCopy = [...this.inputs]//Make a copy of the inputs list to delete all of them
        inputsCopy.forEach(input =&gt; {
            input.deleteSelf(silent)
        })
        if(this.output){
            this.output.deleteSelf(silent)
        }
        
        this.parent.nodesOnTheScreen.splice(this.parent.nodesOnTheScreen.indexOf(this),1) //remove this node from the list
        
        if(deletePath){
            this.basicThreadValueProcessing({op: &quot;deletePath&quot;, path: this.path }) //Delete the cached geometry
        }
        
        if(backgroundClickAfter){
            GlobalVariables.currentMolecule.backgroundClick()
        }
    }
    
    /**
     * Runs with each frame to draw the atom.
     */ 
    update() {
        
        this.inputs.forEach(child =&gt; {
            child.update()     
        })
        if(this.output){
            this.output.update()
        }
        
        this.draw()
    }

    /**
     * Create an object containing the information about this atom that we want to save. 
     */ 
    serialize(offset = {x: 0, y: 0}){
        //Offsets are used to make copy and pasted atoms move over a little bit
        var ioValues = []
        this.inputs.forEach(io =&gt; {
            if (typeof io.getValue() == &apos;number&apos; || typeof io.getValue() == &apos;string&apos;){
                var saveIO = {
                    name: io.name,
                    ioValue: io.getValue()
                }
                ioValues.push(saveIO)
            }
        })
        
        var object = {
            atomType: this.atomType,
            name: this.name,
            x: this.x + offset.x,
            y: this.y - offset.y,
            uniqueID: this.uniqueID,
            ioValues: ioValues
        }
        return object
    }
    
    /**
     * Return any contribution from this atom to the README file
     */ 
    requestReadme(){
        //request any contributions from this atom to the readme
        
        return []
    }
    
    /**
     * Set&apos;s the output value and shows the atom output on the 3D view.
     */ 
    decreaseToProcessCountByOne(){
        
        GlobalVariables.topLevelMolecule.census()
        
    }
    
    /**
     * Token update value function to give each atom one by default
     */ 
    updateValue(){
    
    }
    
    /**
     * Used to walk back out the tree generating a list of constants...used for evolve
     */ 
    walkBackForConstants(callback){
        //Pass the call further up the chain
        this.inputs.forEach(input =&gt; {
            input.connectors.forEach(connector =&gt; {
                connector.walkBackForConstants(callback)
            })
        })
    }
    
    /**
     * Displays the atom in 3D and sets the output.
     */ 
    displayAndPropagate(){
        //If this has an output write to it
        if(this.output){
            this.output.setValue(this.path)
            this.output.ready = true
        }
        
        //If this atom is selected, send the updated value to the renderer
        if (this.selected){
            this.sendToRender()
        }
    }
    
    /**
     * Sets the atom to wait on coming information. Basically a pass through, but used for molecules
     */ 
    waitOnComingInformation(){
        if(this.output){
            this.output.waitOnComingInformation()
        }
        
        if(this.processing){
            console.warn(&quot;Processing &quot;+ this.name + &quot; Canceled&quot;)
            this.cancelProcessing()
            this.processing = false
        }
    }
    
    /**
     * Calls a worker thread to compute the atom&apos;s value.
     */ 
    basicThreadValueProcessing(toAsk){
        //If the inputs are all ready
        var go = true
        this.inputs.forEach(input =&gt; {
            if(!input.ready){
                go = false
            }
        })
        if(go){     //Then we update the value
            
            this.waitOnComingInformation() //This sends a chain command through the tree to lock all the inputs which are down stream of this one. It also cancels anything processing if this atom was doing a calculation already.
            
            this.processing = true
            this.decreaseToProcessCountByOne()
            
            
            this.clearAlert()
            
            const {answer, terminate} = window.ask(toAsk)
            answer.then(result =&gt; {
                if (result != -1 ){
                    this.displayAndPropagate()
                }else{
                    this.setAlert(&quot;Unable to compute&quot;)
                }
                this.processing = false
            })
            
            this.cancelProcessing = terminate //This can be called to interrupt the computation
        }
    }
    
    /**
     * Starts propagation placeholder. Most atom types do not begin propagation.
     */ 
    beginPropagation(){
        
    }
    
    /**
     * Returns an array of length two indicating that this is one atom and if it is waiting to be computed
     */ 
    census(){
        var waiting = 0
        this.inputs.forEach(input =&gt; {
            if(input.ready != true){
                waiting = 1
            }
        })
        return [1,waiting]
    }
    
    /**
     * Sets all the input and output values to match their associated atoms.
     */ 
    loadTree(){
        this.inputs.forEach(input =&gt; {
            input.loadTree()
        })
        if(this.output){
            this.output.value = this.path
        }
        return this.path
    }
    
    /**
     * Send the value of this atom to the 3D display.
     */ 
    sendToRender(){
        //Send code to JSxCAD to render
        try{
            GlobalVariables.writeToDisplay(this.path)
        }
        catch(err){
            this.setAlert(err)
        }

    }
    
    /**
     * Find the value of an input for with a given name.
     * @param {string} ioName - The name of the target attachment point.
     */ 
    findIOValue(ioName){
        ioName = ioName.split(&apos;~&apos;).join(&apos;&apos;)
        var ioValue = null
        
        this.inputs.forEach(child =&gt; {
            if(child.name == ioName &amp;&amp; child.type == &apos;input&apos;){
                ioValue = child.getValue()
            }
        })
        
        return ioValue
    }
    
    /**
     * Dump the stored copies of any geometry in this atom to free up ram....probably can be deleted
     */ 
    // dumpBuffer(){
    // this.inputs.forEach(input =&gt; {
    // input.dumpBuffer()
    // })
    // if(this.output){
    // this.output.dumpBuffer()
    // }
    // this.value = null
    // }
    
    /**
     * Creates an editable HTML item to set the value of an object element. Used in the sidebar.
     * @param {object} list - The HTML object to attach the new item to.
     * @param {object} object - The object with the element we are editing.
     * @param {string} key - The key of the element to edit.
     * @param {string} label - The label to display next to the editable value.
     * @param {boolean} resultShouldBeNumber - A flag to indicate if the input should be converted to a number.
     * @param {object} callBack - Optional. A function to call with the new value when the value changes.
     */ 
    createEditableValueListItem(list,object,key, label, resultShouldBeNumber, callBack = () =&gt; console.warn(&quot;no callback&quot;)){

        var listElement = document.createElement(&apos;LI&apos;)
        list.appendChild(listElement)
        
        
        //Div which contains the entire element
        var div = document.createElement(&apos;div&apos;)
        listElement.appendChild(div)
        div.setAttribute(&apos;class&apos;, &apos;sidebar-item sidebar-editable-div&apos;)
        
        //Left div which displays the label
        var labelDiv = document.createElement(&apos;label&apos;)
        div.appendChild(labelDiv)
        var labelText = document.createTextNode(label + &apos;:&apos;)
        labelDiv.appendChild(labelText)
        labelDiv.setAttribute(&apos;class&apos;, &apos;sidebar-subitem label-item&apos;)
        
        
        //Right div which is editable and displays the value
        var valueTextDiv = document.createElement(&apos;span&apos;)
        labelDiv.appendChild(valueTextDiv)
        var valueText = document.createTextNode(object[key])
        valueTextDiv.appendChild(valueText)
        valueTextDiv.setAttribute(&apos;contenteditable&apos;, &apos;true&apos;)
        valueTextDiv.setAttribute(&apos;class&apos;, &apos;editing-item&apos;)
        var thisID = label+GlobalVariables.generateUniqueID()
        valueTextDiv.setAttribute(&apos;id&apos;, thisID)
        
        
        document.getElementById(thisID).addEventListener(&apos;focusout&apos;,() =&gt;{
            var valueInBox = document.getElementById(thisID).textContent.trim()
            if(resultShouldBeNumber){
                valueInBox = GlobalVariables.limitedEvaluate(valueInBox)
            }
            
            //If the target is an attachmentPoint then call the setter function
            if(object instanceof AttachmentPoint){
                object.setValue(valueInBox)
            }
            else{
                object[key] = valueInBox
                callBack(valueInBox)
            }
        })
        
        //prevent the return key from being used when editing a value
        document.getElementById(thisID).addEventListener(&apos;keypress&apos;, function(evt) {
            if (evt.which === 13) {
                evt.preventDefault() 
                document.getElementById(thisID).blur() //shift focus away if someone presses enter
            }
        })

    }
    
    /**
     * Creates an non-editable HTML item to set the value of an object element. Used in the sidebar.
     * @param {object} list - The HTML object to attach the new item to.
     * @param {object} object - The object with the element we are displaying.
     * @param {string} key - The key of the element to display.
     * @param {string} label - The label to display next to the displayed value.
     */ 
    createNonEditableValueListItem(list,object,key, label){
        var listElement = document.createElement(&apos;LI&apos;)
        list.appendChild(listElement)
        
        
        //Div which contains the entire element
        var div = document.createElement(&apos;div&apos;)
        listElement.appendChild(div)
        div.setAttribute(&apos;class&apos;, &apos;sidebar-item sidebar-editable-div&apos;)
        
        //Left div which displays the label
        var labelDiv = document.createElement(&apos;div&apos;)
        div.appendChild(labelDiv)
        var labelText = document.createTextNode(label + &apos;:&apos;)
        labelDiv.appendChild(labelText)
        labelDiv.setAttribute(&apos;class&apos;, &apos;sidebar-subitem label-item&apos;)
        
        
        //Right div which is editable and displays the value
        var valueTextDiv = document.createElement(&apos;div&apos;)
        div.appendChild(valueTextDiv)
        var valueText = document.createTextNode(object[key])
        valueTextDiv.appendChild(valueText)
        valueTextDiv.setAttribute(&apos;contenteditable&apos;, &apos;false&apos;)
        valueTextDiv.setAttribute(&apos;class&apos;, &apos;sidebar-subitem noediting-item&apos;)
        var thisID = label+GlobalVariables.generateUniqueID()
        valueTextDiv.setAttribute(&apos;id&apos;, thisID)
        

    }
    
    /**
     * Creates a html representation of the passed text. Used in the sidebar.
     * @param {object} list - The HTML object to attach the new item to.
     * @param {string} texxt - The text used to generate the markdown html.
     */ 
    createMarkdownListItem(list, text){
        
        var converter = new showdown.Converter()
        //var text      = &apos;# hello, markdown!&apos;
        var html      = converter.makeHtml(text)
        
        var markdownTextDiv = document.createElement(&apos;div&apos;)
        markdownTextDiv.innerHTML = html
        
        //var valueText = document.createTextNode(text)
        //valueTextDiv.appendChild(valueText)
        list.appendChild(markdownTextDiv)       
    }
    
    /**
     * Creates dropdown with multiple options to select. Used in the sidebar.
     * @param {object} list - The HTML object to attach the new item to.
     * @param {object} parent - The parent which has the function to call on the change...this should really be done with a callback function.
     * @param {array} options - A list of options to display in the drop down.
     * @param {number} selectedOption - The zero referenced index of the selected option.
     * @param {string} description - A description of what the dropdown does.
     * @param {object} Callback function
     */ 
    createDropDown(list,parent,options,selectedOption, description, callback){
        var listElement = document.createElement(&apos;LI&apos;)
        list.appendChild(listElement)
        
        
        //Div which contains the entire element
        var div = document.createElement(&apos;div&apos;)
        listElement.appendChild(div)
        div.setAttribute(&apos;class&apos;, &apos;sidebar-item&apos;)
        
        //Left div which displays the label
        var labelDiv = document.createElement(&apos;div&apos;)
        div.appendChild(labelDiv)
        var labelText = document.createTextNode(description)
        labelDiv.appendChild(labelText)
        labelDiv.setAttribute(&apos;class&apos;, &apos;sidebar-subitem&apos;)
        
        
        //Right div which is editable and displays the value
        var valueTextDiv = document.createElement(&apos;div&apos;)
        div.appendChild(valueTextDiv)
        var dropDown = document.createElement(&apos;select&apos;)
        options.forEach(option =&gt; {
            var op = new Option()
            op.value = options.findIndex(thisOption =&gt; thisOption === option)
            op.text = option
            dropDown.options.add(op)
        })
        valueTextDiv.appendChild(dropDown)
        valueTextDiv.setAttribute(&apos;class&apos;, &apos;sidebar-subitem&apos;)
        
        dropDown.selectedIndex = selectedOption //display the current selection
        
        dropDown.addEventListener(
            &apos;change&apos;,
            function() { callback(dropDown.value) },
            false
        )
    }
    
    /**
     * Creates button. Used in the sidebar.
     * @param {object} list - The HTML object to attach the new item to.
     * @param {object} parent - The parent which has the function to call on the change...this should really be done with a callback function.
     * @param {string} buttonText - The text on the button.
     * @param {object} functionToCall - The function to call when the button is pressed.
     */ 
    createButton(list,parent,buttonText,functionToCall){
        var listElement = document.createElement(&apos;LI&apos;)
        list.appendChild(listElement)
        
        
        //Div which contains the entire element
        var div = document.createElement(&apos;div&apos;)
        listElement.appendChild(div)
        div.setAttribute(&apos;class&apos;, &apos;runSideBarDiv&apos;)
        
        
        //Right div which is button
        var valueTextDiv = document.createElement(&apos;div&apos;)
        div.appendChild(valueTextDiv)
        var button = document.createElement(&apos;button&apos;)
        var buttonTextNode = document.createTextNode(buttonText)
        button.setAttribute(&apos;class&apos;, &apos; browseButton&apos;)
        button.setAttribute(&apos;id&apos;, buttonText.replace(/\s+/g, &quot;&quot;) + &quot;-button&quot;)
        button.appendChild(buttonTextNode)
        valueTextDiv.appendChild(button)
        valueTextDiv.setAttribute(&apos;class&apos;, &apos;sidebar-subitem&apos;)
        
        button.addEventListener(
            &apos;mousedown&apos;,
            function() { functionToCall() } ,
            false
        )
    }
    
    /**
     * Creates file upload button. Used in the sidebar.
     * @param {object} list - The HTML object to attach the new item to.
     * @param {object} parent - The parent which has the function to call on the change...this should really be done with a callback function.
     * @param {string} buttonText - The text on the button.
     * @param {object} functionToCall - The function to call when the button is pressed.
     */ 
    createFileUpload(list,parent,buttonText,functionToCall){
        var listElement = document.createElement(&apos;LI&apos;)
        list.appendChild(listElement)
        
        
        //Div which contains the entire element
        var div = document.createElement(&apos;div&apos;)
        listElement.appendChild(div)
        div.setAttribute(&apos;class&apos;, &apos;runSideBarDiv&apos;)
        
        
        //Right div which is button
        var valueTextDiv = document.createElement(&apos;div&apos;)
        div.appendChild(valueTextDiv)
        var button = document.createElement(&apos;input&apos;)
        button.type = &quot;file&quot;
        var buttonTextNode = document.createTextNode(buttonText)
        button.setAttribute(&apos;class&apos;, &apos; browseButton&apos;)
        button.setAttribute(&apos;id&apos;, buttonText.replace(/\s+/g, &quot;&quot;) + &quot;-button&quot;)
        button.appendChild(buttonTextNode)
        valueTextDiv.appendChild(button)
        valueTextDiv.setAttribute(&apos;class&apos;, &apos;sidebar-subitem&apos;)
        
        button.addEventListener(
            &apos;change&apos;,
            functionToCall,
            false
        )
    }
    
    /**
     * Creates button. Used in the sidebar.
     * @param {object} list - The HTML object to attach the new item to.
     * @param {string} buttonText - The text on the button.
     * @param {boolean} - Flag to see if checkbox is checked
     * @param {object} functionToCall - The function to call when the button is pressed.
     */ 
    createCheckbox(sideBar,text,isChecked,callback){
        var gridDiv = document.createElement(&apos;div&apos;)
        sideBar.appendChild(gridDiv)
        gridDiv.setAttribute(&apos;id&apos;, text + &quot;-parent&quot;)
        gridDiv.setAttribute(&apos;class&apos;, &quot;sidebar-checkbox&quot;)
        var gridCheck = document.createElement(&apos;input&apos;)
        gridDiv.appendChild(gridCheck)
        gridCheck.setAttribute(&apos;type&apos;, &apos;checkbox&apos;)
        gridCheck.setAttribute(&apos;id&apos;, text)
        
        if (isChecked){
            gridCheck.setAttribute(&apos;checked&apos;, &apos;true&apos;)
        }
        

        var gridCheckLabel = document.createElement(&apos;label&apos;)
        gridDiv.appendChild(gridCheckLabel)
        gridCheckLabel.setAttribute(&apos;for&apos;, &apos;gridCheck&apos;)
        gridCheckLabel.setAttribute(&apos;style&apos;, &apos;margin-right:1em;&apos;)
        gridCheckLabel.textContent = text

        gridCheck.addEventListener(&apos;change&apos;, event =&gt; {
            callback(event)
        })
    }
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
