<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/js/globalvariables.js | canvas-template</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#js">js</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/BOM.js~BOMEntry.html">BOMEntry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/globalvariables.js~GlobalVariables.html">GlobalVariables</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-convertLinks">convertLinks</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extractBomTags">extractBomTags</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-showGitHubSearch">showGitHubSearch</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addOrDeletePorts">addOrDeletePorts</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GitHubModule">GitHubModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-cmenu">cmenu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-globalVariables">globalVariables</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-licenses">licenses</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#js-molecules">js/molecules</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/BOM.js~AddBOMTag.html">AddBOMTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/assembly.js~Assembly.html">Assembly</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/box.js~Box.html">Box</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/circle.js~Circle.html">Circle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/code.js~Code.html">Code</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/color.js~Color.html">Color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/constant.js~Constant.html">Constant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/cutlayout.js~CutLayout.html">CutLayout</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/cutlist.js~CutList.html">CutList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/difference.js~Difference.html">Difference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/equation.js~Equation.html">Equation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/extracttag.js~ExtractTag.html">ExtractTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/extrude.js~Extrude.html">Extrude</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/gcode.js~Gcode.html">Gcode</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/geneticAlgorithm.js~GeneticAlgorithm.html">GeneticAlgorithm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/githubmolecule.js~GitHubMolecule.html">GitHubMolecule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/group.js~Group.html">Group</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/input.js~Input.html">Input</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/intersection.js~Intersection.html">Intersection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/molecule.js~Molecule.html">Molecule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/move.js~Move.html">Move</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/nest.js~Nest.html">Nest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/output.js~Output.html">Output</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/readme.js~Readme.html">Readme</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/rectangle.js~Rectangle.html">Rectangle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/regularPolygon.js~RegularPolygon.html">RegularPolygon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/rotate.js~Rotate.html">Rotate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/shrinkwrap.js~ShrinkWrap.html">ShrinkWrap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/stl.js~Stl.html">Stl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/svg.js~Svg.html">Svg</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/tag.js~Tag.html">Tag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/molecules/uploadSVG.js~UploadSVG.html">UploadSVG</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#js-prototypes">js/prototypes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/prototypes/atom.js~Atom.html">Atom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/prototypes/attachmentpoint.js~AttachmentPoint.html">AttachmentPoint</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/prototypes/connector.js~Connector.html">Connector</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/js/globalvariables.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { create, all }  from &apos;mathjs&apos;
import Assembly         from &apos;./molecules/assembly.js&apos;
import Box              from &apos;./molecules/box.js&apos;
import CutList          from &apos;./molecules/cutlist.js&apos;
import Circle           from &apos;./molecules/circle.js&apos;
import Color            from &apos;./molecules/color.js&apos;
import CutLayout        from &apos;./molecules/cutlayout.js&apos;
import Rectangle        from &apos;./molecules/rectangle.js&apos;
import ShrinkWrap       from &apos;./molecules/shrinkwrap.js&apos;
import Move             from &apos;./molecules/move.js&apos;
import Tag              from &apos;./molecules/tag.js&apos;
import RegularPolygon   from &apos;./molecules/regularpolygon.js&apos;
import Extrude          from &apos;./molecules/extrude.js&apos;
import Stl              from &apos;./molecules/stl.js&apos;
import Svg              from &apos;./molecules/svg.js&apos;
//import Nest              from &apos;./molecules/nest.js&apos;
import Intersection     from &apos;./molecules/intersection.js&apos;
import Difference       from &apos;./molecules/difference.js&apos;
import Constant         from &apos;./molecules/constant.js&apos;
import Equation         from &apos;./molecules/equation.js&apos;
import ExtractTag       from &apos;./molecules/extracttag.js&apos;
import Molecule         from &apos;./molecules/molecule.js&apos;
import GeneticAlgorithm from &apos;./molecules/geneticAlgorithm.js&apos;
import Input            from &apos;./molecules/input.js&apos;
import Readme           from &apos;./molecules/readme.js&apos;
import AddBOMTag        from &apos;./molecules/BOM.js&apos;
import Rotate           from &apos;./molecules/rotate.js&apos;
import GitHubMolecule   from &apos;./molecules/githubmolecule.js&apos;
import Output           from &apos;./molecules/output.js&apos;
import Gcode            from &apos;./molecules/gcode.js&apos;
import Code             from &apos;./molecules/code.js&apos;
import Group            from &apos;./molecules/group.js&apos;
import UploadSVG        from &apos;./molecules/uploadSVG.js&apos;
import GitHubModule     from &apos;./githubOauth&apos;

/**
 * This class defines things which are made available to all objects which import it. It is a singlton which means that each time it is imported the same instance is made available so if it is written to in one place, it can be read somewhere else.
 */
class GlobalVariables{
    /**
     * The constructor creates a new instance of the Global Variables object.
     */
    constructor(){
        /** 
         * The canvas object on which the atoms are drawn.
         * @type {object}
         */
        this.canvas = null
        /** 
         * The 2D reference to the canvas object on which the atoms are drawn.
         * @type {object}
         */
        this.c = null
        /** 
        * An array of all of the available types of atoms which can be placed with a right click.
        * @type {array}
        */
        this.availableTypes = {
        
            box:                {creator: Box, atomType: &apos;Box&apos;},
            
            intersection:       {creator: Intersection, atomType: &apos;Intersection&apos;, atomCategory: &apos;Interactions&apos;},
            difference:         {creator: Difference, atomType: &apos;Difference&apos;, atomCategory: &apos;Interactions&apos;},
            assembly:           {creator: Assembly, atomType: &apos;Assembly&apos;, atomCategory: &apos;Interactions&apos;},
            union:              {creator: Group, atomType: &apos;Union&apos;, atomCategory: &apos;None&apos;},
            group:              {creator: Group, atomType: &apos;Group&apos;, atomCategory: &apos;Interactions&apos;},
            shrinkwrap:         {creator: ShrinkWrap, atomType: &apos;ShrinkWrap&apos;, atomCategory: &apos;Interactions&apos;},
            
            
            readme:             {creator: Readme, atomType: &apos;Readme&apos;, atomCategory: &apos;Tags&apos;},
            addBOMTag:          {creator: AddBOMTag, atomType: &apos;Add-BOM-Tag&apos;, atomCategory: &apos;Tags&apos;},
            color:              {creator: Color, atomType: &apos;Color&apos;, atomCategory: &apos;Tags&apos;},
            tag:                {creator: Tag, atomType: &apos;Tag&apos;, atomCategory: &apos;Tags&apos;},
            extracttag:         {creator: ExtractTag, atomType: &apos;ExtractTag&apos;, atomCategory: &apos;Tags&apos;},
            cutLayout:          {creator: CutLayout, atomType: &apos;CutLayout&apos;, atomCategory: &apos;Tags&apos;},
            CutList:            {creator: CutList, atomType: &apos;CutList&apos;, atomCategory: &apos;Tags&apos;},


            
            regularPolygon:     {creator: RegularPolygon, atomType: &apos;RegularPolygon&apos;, atomCategory: &apos;Shapes&apos;},
            costant:            {creator: Constant, atomType: &apos;Constant&apos;, atomCategory: &apos;Inputs&apos;},
            circle:             {creator: Circle, atomType: &apos;Circle&apos;, atomCategory: &apos;Shapes&apos;},
            rectangle:          {creator: Rectangle, atomType: &apos;Rectangle&apos;, atomCategory: &apos;Shapes&apos;},
            molecule:           {creator: Molecule, atomType: &apos;Molecule&apos;, atomCategory: &apos;Shapes&apos;},
            input:              {creator: Input, atomType: &apos;Input&apos;, atomCategory: &apos;Inputs&apos;},
            equation:           {creator: Equation, atomType: &apos;Equation&apos;, atomCategory: &apos;Inputs&apos;},
            code:               {creator: Code, atomType: &apos;Code&apos;, atomCategory: &apos;Inputs&apos;},
            
            rotate:             {creator: Rotate, atomType: &apos;Rotate&apos;, atomCategory: &apos;Actions&apos;},
            extrude:            {creator: Extrude, atomType: &apos;Extrude&apos;, atomCategory: &apos;Actions&apos;},
            move:               {creator: Move, atomType: &apos;Move&apos;, atomCategory: &apos;Actions&apos;},
            translate:          {creator: Move, atomType: &apos;Translate&apos;, atomCategory: &apos;none&apos;},
            GeneticAlgorithm:   {creator: GeneticAlgorithm, atomType: &apos;GeneticAlgorithm&apos;, atomCategory: &apos;Actions&apos;},

            stl:                {creator: Stl, atomType: &apos;Stl&apos;, atomCategory: &apos;Export&apos;},
            svg:                {creator: Svg, atomType: &apos;Svg&apos;, atomCategory: &apos;Export&apos;},
            //nest:               {creator: Nest, atomType: &apos;Nest&apos;, atomCategory: &apos;Export&apos;},
            gcode:              {creator: Gcode, atomType: &apos;Gcode&apos;, atomCategory: &apos;Export&apos;},
            uploadSVG:          {creator: UploadSVG, atomType: &apos;UploadSVG&apos;, atomCategory: &apos;Export&apos;},
            githubmolecule:     {creator: GitHubMolecule, atomType: &apos;GitHubMolecule&apos;, atomCategory: &apos;Inputs&apos;},

            output:             {creator: Output, atomType: &apos;Output&apos;}
        }
        /** 
         * A reference to the molecule curently being displayed on the screen.
         * @type {object}
         */
        this.currentMolecule
        /** 
         * A reference to the top level molecule of the project.
         * @type {object}
         */
        this.topLevelMolecule
        /** 
         * A flag to indicate if the program is running in run mode (ie a shared link).
         * @type {boolean}
         */
        this.runMode = false
        /** 
         * A flag to indicate if the program is running with a touch interface. Set in flowDraw.js.
         * @type {boolean}
         */
        this.touchInterface = false
        /** 
         * The github object which is used to interact with GitHub.
         * @type {object}
         */
        this.gitHub = new GitHubModule()
        /** 
         * A total of the number of atoms in this project
         * @type {integer}
         */
        this.totalAtomCount = 0
        /** 
         * A counter used during the loading process to keep track of how many atoms are still to be loaded.
         * @type {integer}
         */
        this.numberOfAtomsToLoad = 0
        /** 
         * A flag to indicate if the project is a fork.
         * @type {boolean}
         */
        this.fork = false
        /** 
         * A flag to indicate if command is pressed
         * @type {boolean}
         */
        this.ctrlDown = false
        /** 
         * A variable to save array to be copied
         * @type {array}
         */
        this.atomsSelected = []
        /** 
         * The size (in mm) of segments to use for circles.
         * @type {number}
         */
        this.circleSegmentSize = 2
        /** 
         * A flag to indicate if a display value is currently being processed.
         * @type {bool}
         */
        this.displayProcessing = false
        /** 
         * The function to call to cancel the processing of the prevous display value.
         * @type {function}
         */
        this.cancelLastDisplayWorker = function(){}
        /** 
         * The last path displayed. Used for updating the display when the controls change.
         * @type {string}
         */
        this.displayedPath = &quot;&quot;
        /** 
         * A list of all of the paths in this project which can be read from memory
         * @type {array}
         */
        this.availablePaths = []
        /** 
         * A flag to indicate if a grid should be displayed behind the shape
         * @type {boolean}
         */
        this.displayGrid = true
        /** 
         * A flag to indicate if the edges of the shape should be displayed.
         * @type {boolean}
         */
        this.displayAxis = true
        /** 
         * A flag to indicate if the display should show axis.
         * @type {boolean}
         */
        this.displayTriangles = true
        /** 
         * A flag to indicate if the faces of the shape should be displayed.
         * @type {boolean}
         */
        this.displayEdges = true
         
        const math = create(all)  //What does this do? I think it is used to evalue strings as math
        /** 
         * An evaluator for strings as mathmatical equations which is sandboxed and secure.
         * @type {function}
         */
        this.limitedEvaluate = math.evaluate
        math.import({
            &apos;import&apos;:     function () { throw new Error(&apos;Function import is disabled&apos;) },
            &apos;createUnit&apos;: function () { throw new Error(&apos;Function createUnit is disabled&apos;) },
            &apos;evaluate&apos;:   function () { throw new Error(&apos;Function evaluate is disabled&apos;) },
            &apos;parse&apos;:      function () { throw new Error(&apos;Function parse is disabled&apos;) },
            &apos;simplify&apos;:   function () { throw new Error(&apos;Function simplify is disabled&apos;) },
            &apos;derivative&apos;: function () { throw new Error(&apos;Function derivative is disabled&apos;) }
        }, { override: true })
    }

    /** 
    * A function to generate a pixel value for 0-1 location on screen depending on screen width
    * @param {number} width 0-1 
    */
    widthToPixels(width){
        width = Math.min(width, 1) //Constrain the position to be a max of 1
        let pixels = this.canvas.width * width
        return pixels
    }
    /** 
    * A function to generate a 0-1 value from pixels for location on screen depending on screen width
    * @param {number} width 0-1 
    */
    pixelsToWidth(pixels){
        let width = 1 /(this.canvas.width / pixels)
        return width
    }
    /** 
    * A function to generate a pixel value for 0-1 location on screen depending on screen height
    * @param {number} width 0-1 
    */
    heightToPixels(height){
        height = Math.min(height, 1) //Constrain the position of the max value to be 1
        let pixels = this.canvas.height * height
        return pixels
    }
    /** 
    * A function which reads from a path and displays the geometry it contains
    * @param {string} The path to read from
    */
    writeToDisplay(path, resetView = false){
        
        this.displayedPath = path
        
        // Cancel the last write to display if there is one active because this one will replace it
        if(this.displayProcessing){
            //this.cancelLastDisplayWorker()
            this.displayProcessing = false
        }
        
        var returned = window.ask({ evaluate: &quot;md`hello`&quot;, 
            key: &quot;display&quot;, 
            readPath: path, 
            triangles: this.displayTriangles, 
            outline: this.displayEdges, 
            wireframe: false 
        })
        
        returned.then( result =&gt; {
            
            this.displayProcessing = false
            document.getElementById(&apos;viewerContext&apos;).style.filter=&quot;sepia(0%)&quot;
            
            if(result &amp;&amp; result != -1){
                window.updateDisplay(result, {withGrid: this.displayGrid, fit: resetView})
            }
        }).catch (() =&gt; console.warn(&quot;Canceled display update&quot;))
        
        this.displayProcessing = true
        document.getElementById(&apos;viewerContext&apos;).style.filter=&quot;sepia(100%)&quot;
        
        /** 
        * A function which cancels the worker processing display when called
        */
        this.cancelLastDisplayWorker = returned.terminate
    }
    /** 
    * A function to generate a 0-1 value from pixels for location on screen depending on screen height
    * @param {number} width 0-1 
    */
    pixelsToHeight(pixels){
        let height = 1 /(this.canvas.height / pixels)
        return height
    }
    
    /** 
     * A function to generate a unique ID value. Currently uses random which does not gurintee that it will be unique.
     */
    generateUniqueID(){
        return Math.floor(Math.random()*900000) + 100000
    }
    
    /**
     * Computes the distance between two points on a plane. This is a duplicate of the one in utils which should probably be deleted.
     * @param {number} x1 - The x cordinate of the first point.
     * @param {number} x2 - The x cordinate of the second point.
     * @param {number} y1 - The y cordinate of the first point.
     * @param {number} y2 - The y cordinate of the second point.
     */ 
    distBetweenPoints(x1, x2, y1, y2){
        var a2 = Math.pow(x1 - x2, 2)
        var b2 = Math.pow(y1 - y2, 2)
        var dist = Math.sqrt(a2 + b2)
        
        return dist
    }


}

/**
 * Because we want global variables to be the same every time it is imported we export an instance of global variables instead of the constructor.
 */
export default (new GlobalVariables)</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
